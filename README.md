# DeliveryService
 배달 서비스 API 연습입니다.

# 작업 후 느낀 점 ✅
    - 코드를 처음 구성할 때 생성자 응용법을 너무 몰라서 직관적이지 못 한 부분들이 많았다. 이 부분에 대한 개선을 많이 진행했는데, 어떻게 해야 코드가 보기 좋아지고 읽기 쉬워지는지 점점 감이 잡히는 것 같다.
    
    - 코드를 작성하는 중간에 엔티티명이 직관적이지 않아 한 번 리팩터 과정을 거쳤는데, 그렇게 하고보니 인스턴스명은 수정되지 않아 이걸 수정하느라 고생했다. 처음에 작명하는 순간이 가장 중요하고, 지어놓은 순간 그 이름을 변경하는것은 매우 어렵다는 것을 깨달았다.
    
    - 설계할 때 가장 어려웠던 점이 JPA에서는 어떻게 관계를 정의하는가에 대한 것이었는데, 이번 기회를 통해 어떤 식으로 관계를 가져야 하는건지 알게됐다.
    
    - 사용자가 보게 될 주문내역서를 API 명세표만 보고 설계했을 때는 엔티티의 내용이 각종 테이블과 관계가 있는 것으로 보여 관계를 지어놨는데,
      그렇게 만들고보니 사용자가 주문내역서를 볼 때마다 메뉴의 이름이나 가격이 해당 음식점이 메뉴를 수정할 때마다 바뀌게 되었다.
      주문내역서는 외부의 변화가 있더라도 정적으로 존재해야 하는데, 이 부분을 간과한 것이었다.
      그래서 결국 수정은 음식점 자체의 정보(매장의 이름, id값)는 관계를 맺어 동적으로 받되, 주문한 음식의 목록과 가격은 등록한 시점 그대로 볼 수 있도록 다시 수정을 해줬다.
      이 경험을 통해, 섬세하지 않은 요구사항 분석은 실질적인 에러가 발생하지 않더라도 그 요구사항을 만족시키지 못 할 수도 있다는 점을 깨닫게 했고,
      요구사항 분석 과정의 중요성을 깨닫게 됐다.

# 11/29 작업 
## 음식점 정보 등록 및 조회
- 음식점 정보 입력받아 등록
    1. 음식점 이름 (name)
    2. 최소주문 가격 (minOrderPrice)
        1. 허용값: 1,000원 ~ 100,000원 입력
        2. 100 원 단위로만 입력 가능 (예. 2,220원 입력 시 에러발생. 2,300원은 입력 가능)
        3. 허용값이 아니거나 100원 단위 입력이 아닌 경우 에러 발생시킴
    3. 기본 배달비 (deliveryFee)
        1. 허용값: 0원 ~ 10,000원
        2. 500 원 단위로만 입력 가능 (예. 2,200원 입력 시 에러발생. 2,500원 입력 가능)
        3. 허용값이 아니거나 1,000원 단위 입력이 아닌 경우 에러 발생시킴

- 음식점 조회
    - 등록된 모든 음식점 정보 조회 가능
        1. 등록 시 입력한 음식점 정보 (name, minOrderPrice, deliveryFee)
        2. DB 테이블 ID (id)

## 음식 등록 및 메뉴판 조회
- 음식점 ID 및 음식 정보 입력받아 등록
    1. 음식점 ID (restaurantId)
        1. 음식점 DB 테이블 ID
    2. 음식명 (name)
        1. 같은 음식점 내에서는 음식 이름이 중복될 수 없음 (예. '자담치킨 강남점'에 '후라이드치킨' 이 이미 등록되어 있다면 중복하여 등록할 수 없지만, 다른 음식점인 '맘스터치 강남점'에는 '후라이드치킨' 을 등록 가능)
    3. 가격 (price)
        1. 허용값: 100원 ~ 1,000,000원
        2. 100 원 단위로만 입력 가능 (예. 2,220원 입력 시 에러발생. 2,300원 입력 가능)
        3. 허용값이 아니거나 100원 단위 입력이 아닌 경우 에러 발생시킴

- 메뉴판 조회
    - 하나의 음식점에 등록된 모든 음식 정보 조회
        1. 등록 시 입력한 음식 정보 (name, price)
        2. DB 테이블 ID (id)

## 주문 요청하기 및 주문 조회
- 주문 요청 시 배달 음식점 및 음식 정보 입력받음
    1. 음식점 ID (restaurantId)
    2. 음식 주문 정보 (foods)
        1. 음식 ID (id)
        2. 음식을 주문할 수량 (quantity)
            1. 허용값: 1 ~ 100
            2. 허용값이 아니면 에러 발생시킴

- 주문 요청에 대한 응답으로 다음 정보를 포함시킴
    1. 주문 음식점 이름 (restaurantName)
    2. 주문 음식 정보 (foods)
        - 주문 음식명 (name)
        - 주문 수량 (quantity)
        - 주문 음식의 가격 (price)
            - 계산방법
                - 주문 음식 1개의 가격 * 주문 수량
    3. 배달비 (deliveryFee)
        - 주문 음식점의 기본 배달비
    4. 최종 결제 금액 (totalPrice)
        - 계산방법
            - 주문 음식 가격들의 총 합 + 배달비
        - "주문 음식 가격들의 총 합" 이 주문 음식점의 "최소주문 가격" 을 넘지 않을 시 에러 발생시킴

- 주문 조회
    - 그동안 성공한 모든 주문 요청을 조회 가능


# 12/1 작업

1. 배달 가능한 음식점 조회
2. 거리별 배달비 산정
3. 역할 별 (음식점 사장님, 사용자) API 인가

## 배달 가능한 음식점 조회

실제 주소 정보를 사용하지 않고, 가상의 X, Y 축 공간을 주소로 사용

"**(X축 값, Y축 값)" 으로 주소 표시**

- X축 값: 0 ~ 99
- Y축 값: 0 ~ 99

예를 들어, 주소 **"(4, 3)"** 은 **"X: 4, Y: 3"** 을 나타냄

1. 음식점 등록 시 "음식점 주소" 를 추가로 입력 받음
    
    예) 요청 Body 를 통해 주소 **"(4, 3)"**을 입력 받음
    
    **"POST /restaurant/register"**
    
    요청 Body
    
    ```json
    {
      name: "쉐이크쉑 청담점",
      minOrderPrice: 5000,
      deliveryFee: 2000,
    	 x: 4,
      y: 3
    }
    ```
    
2. 음식점 조회 시 "배달받을 주소" 를 추가로 입력 받음
    
    예) API 파라미터를 통해 **"(6, 2)"** 을 입력받음
    
    **"GET /restaurants?x=6&y=2"**
    

1. "배달받을 주소" 에서 최대 3 km 내에 있는 음식점들만 조회되어야 함
- x축 1칸 이동을 1km 로 판단
- y축 1칸 이동을 1km 로 판단
    
    

예) "배달받을 주소"가 **"(4, 3)"** 이라면 최대 배달 가능한 범위인 3 km 로 계산해보면 아래와 같이 마름모가 그려지고, 마름모 내에 있는 음식점들만 배달이 가능하다고 판단할 수 있음

## 거리별 배달비 산정

1. 배달 받을 주소와 음식점 간의 거리 1km 당 500원씩 "배달비 할증"가 추가됨
    1. 총 배달비 = 음식점의 기본 배달비 + 거리별 "배달비 할증"

## 역할 별 API 인가 처리

스프링 시큐리티를 사용해 현재까지 구현한 API 를 "음식점 사장님, 사용자"로 역할 별 사용 가능한 API 로 나누어 제공

1. 회원 관리 기능
    - 회원 가입 및 로그인
        - 사장님, 사용자 구분
        - 사장님 (음식점 사장님)
            - 아이디
            - 비밀번호
            - 사장님 이름
        - 사용자
            - 아이디
            - 비밀번호
            - 닉네임
            
2. 역할 별 API 인가처리
    - 사장님
        - 음식점 등록 및 음식 등록만 가능
    - 사용자
        - 음식점 등록 및 음식 등록 불가
        - 나머지 API 모두 허용


# 12/2 작업
## 음식점, 음식 일시 정지 기능
    1. 음식점에 배달이 폭주하여 도저히 음식을 제 시간에 못 만드는 경우 음식점 배달 주문이 안 되도록 일시 정지를 할 수 있게 하는 기능을 추가
    2. 음식점이 일시정지되어 있는 경우에는 음식점 조회 시 노출되지 않음.
## "카테고리" 별 음식점 조회
    1. 음식에 카테고리를 붙여, 카테고리를 검색할 때 해당 카테고리가 존재하는 음식점들을 출력.
## 음식에 옵션 추가
    1. 짜장면 선택 후 '곱배기' 추가 시 1,000 원 추가 와 같은 옵션 추가.


# 12/4 작업
## 코드 수정
    - Dto 인스턴스 생성 과정에서 생성자를 이용하지 않은 코드를 최대한 줄임.
